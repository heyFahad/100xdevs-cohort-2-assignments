<!DOCTYPE html>
<html>
    <head>
        <script>
            let globalId = 1;
            let todoState = [];
            let oldTodoState = [];

            function addTodoToDom(todo) {
                const todoWrapper = document.createElement('div');
                todoWrapper.id = `todo-${todo.id}`;
                todoWrapper.style = 'margin: 8px 0; padding: 16px; color: white; background-color: teal; border: 1px dotted green; border-radius: 8px;';

                // create the title tag
                const titleElement = document.createElement('p');
                titleElement.innerText = todo.title;
                titleElement.style = 'margin: 0; padding: 0; margin-bottom: 8px;';

                // similarly, create the description tag
                const descriptionElement = document.createElement('p');
                descriptionElement.innerText = todo.description;
                descriptionElement.style = 'margin: 0; padding: 0;';

                // then, append both these elements inside the todoWrapper element
                todoWrapper.appendChild(titleElement);
                todoWrapper.appendChild(descriptionElement);

                // finally, attach this new todo in the todos container div to show it on the screen
                const todosContainerDiv = document.querySelector('#todos');
                todosContainerDiv.appendChild(todoWrapper);
            }

            function removeTodoFromDom(todo) {}

            function updateTodoInDom(oldTodo, newTodo) {}

            function updateState(newTodos) {
                // calculate the diff b/w newTodos and oldTodos.
                // More specifically, find out what todos are -
                // 1. added
                // 2. deleted
                // 3. updated
                const added = [];
                const deleted = [];
                const updated = [];
                // calculate these 3 arrays
                // let first find the added and updated todos by iterating over the newTodos array
                newTodos.forEach((newTodo) => {
                    const todoExists = oldTodoState.find((oldTodo) => oldTodo.id === newTodo.id);

                    if (!todoExists) {
                        // it's a new todo with a new ID. Add it to the added array
                        added.push(newTodo);
                    } else {
                        // A todo with the given ID already exists. We need to check if this todo has been changed or not
                        if (JSON.stringify(newTodo) !== JSON.stringify(todoExists)) {
                            // if the todo is changed, push it into the updated array
                            updated.push(newTodo);
                        }
                    }
                });

                // once the added and updated todos are identified, we then need to identify the removed todos by iterating over the oldTodoState
                oldTodoState.forEach((oldTodo) => {
                    const isTodoStillPresent = newTodos.find((newTodo) => newTodo.id === oldTodo.id);
                    if (!isTodoStillPresent) {
                        deleted.push(oldTodo);
                    }
                });

                // call addTodo, removeTodo, updateTodo functions on each of the
                // elements

                // Once the diff is calculated, now we need to update the DOM accordingly
                added.forEach((todo) => {
                    addTodoToDom(todo);
                });

                // after updating the DOM, update the oldTodoState as well in the end
                oldTodoState = [...newTodos];
            }

            function addTodo() {
                const title = document.getElementById('title');
                const description = document.getElementById('description');
                todoState = [
                    ...todoState,
                    {
                        title: title.value,
                        description: description.value,
                        id: globalId++,
                    },
                ];
                updateState([...todoState]);

                // after updating the state, clear the input fields
                title.value = '';
                description.value = '';
            }
        </script>
    </head>

    <body>
        <input type="text" id="title" placeholder="Todo title" /> <br /><br />
        <input type="text" id="description" placeholder="Todo description" /> <br /><br />
        <button onclick="addTodo()">Add todo</button>
        <br />
        <br />

        <div id="todos"></div>
    </body>
</html>
